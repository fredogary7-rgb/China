<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Recharger | AFRIORA</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root{
  --green:#22c55e;
  --border:rgba(34,197,94,.25);
}
*{ box-sizing:border-box; font-family:'Poppins',sans-serif; }

body{
  margin:0;
  background:
    linear-gradient(rgba(5,40,25,.94),rgba(5,40,25,.94)),
    url("/static/images/b.jpg") center/cover no-repeat fixed;
  color:#e6f5ef;
}
.app{ max-width:480px; margin:auto; padding-bottom:120px; }
.header{
  padding:18px 16px;
  display:flex;
  gap:10px;
  background:rgba(7,26,19,.9);
  border-bottom:1px solid var(--border);
}
.hero{
  margin:16px;
  background:linear-gradient(135deg,#052e1d,#064e3b);
  border-radius:22px;
  padding:22px;
  border:1px solid var(--border);
}
.container{ padding:0 16px; }
.section{
  background:rgba(11,42,32,.95);
  border-radius:20px;
  padding:18px;
  margin-top:18px;
  border:1px solid var(--border);
}
.amount-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.amount-btn{
  padding:12px 0;
  text-align:center;
  border-radius:14px;
  background:#06261b;
  border:1px solid var(--border);
  cursor:pointer;
}
.form-row{ margin-top:14px; }
input,select{
  width:100%;
  padding:13px;
  border-radius:14px;
  background:#06261b;
  border:1px solid var(--border);
  color:#fff;
}
.btn-pay{
  width:100%;
  margin-top:20px;
  padding:15px;
  border-radius:28px;
  background:linear-gradient(135deg,#22c55e,#16a34a);
  border:none;
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <i class="fa-solid fa-arrow-left"></i>
    <span>Recharger le compte</span>
  </div>

  <div class="hero">
    <span>Solde disponible</span>
    <h2>{{ "{:,.0f}".format(user.solde_total or 0) }} XOF</h2>
  </div>

  <div class="container">
    <form class="section" id="depositForm">

      <div class="amount-grid">
        <div class="amount-btn" onclick="setAmount(4000)">4 000</div>
        <div class="amount-btn" onclick="setAmount(8000)">8 000</div>
        <div class="amount-btn" onclick="setAmount(15000)">15 000</div>
        <div class="amount-btn" onclick="setAmount(25000)">25 000</div>
        <div class="amount-btn" onclick="setAmount(50000)">50 000</div>
        <div class="amount-btn" onclick="setAmount(100000)">100 000</div>
      </div>

      <div class="form-row">
        <input type="number" id="montant" name="montant" placeholder="Entrer le montant (min 3 000)" required>
      </div>

      <div class="form-row">
        <select id="country" name="country" onchange="updateOperators()" required>
          <option value="">Sélectionnez le pays</option>
          <option value="TG">Togo</option>
          <option value="BJ">Bénin</option>
          <option value="CI">Côte d’Ivoire</option>
          <option value="BF">Burkina Faso</option>
          <option value="GA">Gabon</option>
          <option value="CM">Cameroun</option>
          <option value="NE">Niger</option>
          <option value="CG">Congo Brazzaville</option>
          <option value="CD">Congo Kinshasa</option>
        </select>
      </div>

      <div class="form-row">
        <select id="operator" name="operator" required>
          <option value="">Sélectionnez le moyen de paiement</option>
        </select>
      </div>

      <div class="form-row">
        <input type="tel" name="phone" placeholder="Numéro Mobile Money" required>
      </div>

      <div class="form-row">
        <input type="text" name="fullname" placeholder="Nom du titulaire" required>
      </div>

      <button class="btn-pay" type="submit">Procéder au paiement</button>
    </form>
  </div>
</div>

<script>
const operatorsByCountry = {
  TG:["TMoney","Moov Money"],
  BJ:["MTN Money","Moov Money"],
  CI:["Orange Money","MTN Money","Moov Money","Wave"],
  BF:["Orange Money","Moov Money"],
  GA:["Airtel Money","Moov Money"],
  CM:["MTN Money","Orange Money"],
  NE:["Airtel Money","Moov Money","Nita"],
  CG:["Airtel Money","MTN Money"],
  CD:["Airtel Money","Orange Money","M-Pesa"]
};

function updateOperators(){
  const c = country.value;
  operator.innerHTML='<option value="">Sélectionnez le moyen de paiement</option>';
  (operatorsByCountry[c]||[]).forEach(o=>{
    operator.innerHTML+=`<option value="${o}">${o}</option>`;
  });
}

function setAmount(v){ montant.value=v; }

document.getElementById("depositForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const res = await fetch("/deposit",{method:"POST",body:new FormData(e.target)});
  const data = await res.json();
  if(data.url){ window.location.href=data.url; }
  else{ alert(data.error||"Erreur de paiement"); }
});
</script>

</body>
</html>
